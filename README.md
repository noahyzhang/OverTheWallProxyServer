# OverTheWallProxyServer
基于socks5 协议一款服务器

在介绍我的项目之前呢，先简单的介绍一下中国的 GFW。叫做中国防火长城。

    GFW 的作用呢，就是部署在中国的边境用来分析与过滤中国境内外网络间的互相访问。他不仅能够限制国内网民访问境外的某些站点，也能限制国外用户访问国内的站点。
    在说之前我们先来了解几个专业的名词

DNS 污染和DNS 劫持

    我们访问网站是通过域名进行访问的，访问这个网站要通过DNS 服务器把域名解析成IP 地址，而DNS 服务器使用UDP 协议，没有任何认证机制。
    因此当你向你的DNS 服务器请求域名解析服务时，可能会被我劫持下来，并且返回一个伪造页面的IP 地址。这就是DNS 劫持
    同样的，当你向你的DNS 服务器请求域名解析服务时，假如我是DNS 服务器，我看到你要访问一个非法网站，那我就给你返回一个404，不存在的页面地址。
    比如：你使用电信或者移动运营商的宽带，默认你是不需要任何DNS 服务器的。因为DNS 服务器由他们提供，于是乎，一旦检测到你访问的网页是不允许访问的，他们就给你返回一个不存在的网页。
    如何解决：
    我可以使用第三方的DNS 服务器
    我可以自己使用VPS 搭建DNS 服务器
    我可以自己修改机器的host 文件，直接IP 访问
    但是，上面的办法都不行了，别急，看下方

封锁IP

    上面提到我们从DNS 上入手进行 穿过网关，但是我们的GFW 做了一件事，针对IP 进行封锁。你既使拿到了非法的IP地址，但是我把这个IP 封了，你咋出去。不过，像google 这样的公司服务器会有很多的镜像IP的，但是目前基本上全部被封锁了，不过也不可能把所有的国外IP 全部封锁，我们还是有机会从国内连接到国外的VPS，进行 穿过网关。
    解决方法：
    我们可以使用VPS 搭建代理
    我们可以使用IPv6，IPv6 地址巨大，想封也封不完，但是还没有普及

封锁HTTP 代理

    我们客户端可以不直接请求目标服务器，而是请求代理服务器，代理服务器再去请求目标服务器，然后返回结果。但是HTTP 传输的是明文，请求中有URL或IP 地址，很容易被检测到。对于HTTP ，虽然通信是加密的，但建立连接之前会给代理服务器发送connect 方法，也会带上要访问的远端服务器地址。如果服务器在国外，也会被检测到。当然服务器在国内，也出不去的呀。
    那么这样说，对于HTTP 代理，相当于在网络环境上裸奔。而HTTPS 能好一点，加密了数据，但是却可以知道你的数据去了哪里。
    解决办法：
    还是使用VPS 搭建 VPN
    或者使用第三方的VPN

封锁VPN

    既然我们都知道可以使用VPS 搭载VPN 来进行绕过GFW，那么我们也可以封锁VPN。虚拟专用网（英语：Virtual Private Network，简称VPN），是一种常用于连接中、大型企业或团体与团体间的私人网络的通讯方法。虚拟私人网络的讯息透过公用的网络架构（例如：互联网）来传送内联网的网络讯息。它利用已加密的通道协议（Tunneling Protocol）来达到保密、发送端认证、消息准确性等私人消息安全效果。 正常网络通信时，所有网络请求都是通过我们的物理网卡直接发送出去。
    而VPN是客户端使用相应的VPN协议先与VPN服务器进行通信，成功连接后就在操作系统内建立一个虚拟网卡，一般来说默认PC上所有网络通信都从这虚拟网卡上进出，经过VPN服务器中转之后再到达目的地. 通常VPN协议都会对数据流进行强加密处理，从而使得第三方无法知道数据内容，这样就实现了穿过GFW。
    穿过GFW 时VPN服务器知道你干的所有事情（就像HTTP一样，对于HTTPS，它知道你去了哪）。 VPN有多种协议：OPENVPN、PPTP、L2TP/IPSec、SSLVPN、IKEv2 VPN，Cisco VPN等。其中的PPTP和L2TP是明文传输协议。只负责传输，不负责加密。分别利用了MPPE和IPSec进行加密。
    因此，对于VPN和其他一些加密的传输的协议来说，没有办法直接获取明文的请求信息，所以没有办法直接封锁，而是使用了监控的方式。
    比如：

    暴力破解
    对于一些使用弱加密方式的协议来说，直接使用暴力破解检查传输内容。比如PPTP使用MPPE加密，但是MPPE是基于RC4，对于强大的防火墙背后的超级计算机集群，破解就是几秒钟的事情，破解后明文中一旦包含了违禁内容，请求就会被封。而对应的IP可能会进入重点关怀列表
    特征检测
    要想成功 的话都必须与对应的远程服务器建立连接，然后再用对应的协议进行数据处理并传输。而问题就出在这里：工具和远程服务器建立连接时，如果表现的很独特，在一大堆流量里很显眼，就会轻易被GFW识别出从而直接阻断连接，而VPN（尤其是OPENVPN）和SSH这方面的问题尤其严重
    流量监控
    当一个VPN地址被大量人请求，并保持长时间连接时，就很容易引起关注。SSH接口有大量数据请求。一般会结合其他特征。
    深度包检测：
    深度数据包检测（Deep packet inspection，缩写为 DPI），又称完全数据包探测（complete packet inspection）或信息萃取（Information eXtraction，IX），是一种电脑网络数据包过滤技术，用来检查通过检测点之数据包的数据部分（亦可能包含其标头），以搜索不匹配规范之协议、病毒、垃圾邮件、入侵，或以预定之准则来决定数据包是否可通过或需被路由至其他不同目的地，亦或是为了收集统计数据之目的。
    因此我们说想要 穿过GFW 可以借助国外的服务器VPS搭载VPN
    我们再来看一个协议

socks5协议

    SOCKS5 是一个代理协议，它在使用TCP/IP协议通讯的前端机器和服务器机器之间扮演一个中介角色，使得内部网中的前端机器变得能够访问Internet网中的服务器，或者使通讯更加安全。SOCKS5 服务器通过将前端发来的请求转发给真正的目标服务器， 模拟了一个前端的行为。在这里，前端和SOCKS5之间也是通过TCP/IP协议进行通讯，前端将原本要发送给真正服务器的请求发送给SOCKS5服务器，然后SOCKS5服务器将请求转发给真正的服务器。【百度百科解释】

socks代理和HTTP代理的异同

    提到socks 代理，那么就需要知道他和HTTP代理有什么异同了。然后，我讲两个故事来分享一下。

SOCKS：Bill希望通过互联网与Jane沟通，但他们的网络之间存在一个防火墙，Bill不能直接与Jane沟通。所以，Bill连接到他的网络上的SOCKS代理，告知它他想要与Jane创建连接；SOCKS代理打开一个能穿过防火墙的连接，并促进Bill和Jane之间的通信。
HTTP：Bill希望从Jane的Web服务器下载一个网页。Bill不能直接连接到Jane的服务器，因为在他的网络上设置了防火墙。为了与该服务器通信，Bill连接到其网络的HTTP代理。他的网页浏览器与代理通信的方式与他直接连接Jane的服务器的方式相同；也就是说，网页浏览器会发送一个标准的HTTP请求头。HTTP代理连接到Jane的服务器，然后将Jane的服务器返回的任何数据传回Bill。

    总结一下：SOCKS工作在比HTTP代理更低的层次：SOCKS使用握手协议来通知代理软件其客户端试图进行的连接SOCKS，然后尽可能透明地进行操作，而常规代理可能会解释和重写报头（例如，使用另一种底层协议，例如FTP；然而，HTTP代理只是将HTTP请求转发到所需的HTTP服务器）。虽然HTTP代理有不同的使用式，CONNECT方法允许转发TCP连接；然而，SOCKS代理还可以转发UDP流量和反向代理，而HTTP代理不能。HTTP代理通常更了解HTTP协议，执行更高层次的过滤（虽然通常只用于GET和POST方法，而不用于CONNECT方法）。
